2006-08-29  Vincent LADEUIL  <v.ladeuil@alplog.fr>

	* webdav.py:
	Add and update TODOs.
	(HttpDavTransport.__init__):  Declare _accept_ranges,  defaults to
	True.
	(HttpDavTransport._head): New method.
	(HttpDavTransport.append):     Select _append_by_head_put or
	_append_by_get_put depending on _accept_ranges.
	(HttpDavTransport._append_by_head_put): New method.
	(HttpDavTransport._append_by_get_put):  New   method  (was  append
	before).
	(HttpDavTransport.put): Uses _put_file do provide an atomic PUT.
	(HttpDavTransport._put_file): New method doing a bare PUT.
	(HttpDavTransport._put_ranged):   New  method  helping   doing  an
	appended PUT.

	* test_webdav.py: 
	Add more TODOs.
	(TestingDAVRequestHandler.do_PUT):  Handle  Content-Range optional
	header to do appends.

	* __init__.py: 
	Requires bzr >= 0.11.0dev.

2006-08-28  Vincent LADEUIL  <v.ladeuil@alplog.fr>
        Prepare merge.

	* webdav.py:
	Add TODOs for  looking at PATCH with Apache and doing
	an urllib implementation. Othe cosmetic changes.

	* test_webdav.py: 
	Fix spurious spaces.

	* NOTES: 
	(Extensions): Remark about PATCH in Apache.

2006-08-27  Vincent LADEUIL  <v.ladeuil+lp@free.fr>
	Implements https://features.launchpad.net/products/bzr.webdav/+spec/curl-persistence.
	
	* webdav.py:
	(HttpDavTransport.__init__):  Copy  the  shared curl  object  when
	cloning.
	(HttpDavTransport._set_curl_common_options):      New      method.
	Initialize the shared curl object.
	(HttpDavTransport._set_curl_options):  New   method.   Reset  used
	options to facilitate sharing of the curl object.
	(HttpDavTransport._add_header): New method.
	(HttpDavTransport._perform): New method.
	(HttpDavTransport.has, HttpDavTransport._get_full,
	HttpDavTransport._get_ranged):    New    methods,   copied    from
	PyCurlTransport but using the shared curl object.
	(HttpDavTransport.mkdir, HttpDavTransport.copy,
	HttpDavTransport.put, HttpDavTransport.rename,
	HttpDavTransport.move, HttpDavTransport.delete): Modified  to use
	the shared curl objects.

	* test_webdav.py:
	(TestingDAVRequestHandler.do_PUT): Cosmetic change.

2006-08-26  Vincent LADEUIL  <v.ladeuil+lp@free.fr>
	Add classes to allow testing of APPEND command on future web servers.
	
	* webdav.py:
	(get_test_permutations):   Require   the   testing  of   the   new
	HttpServer_Dav_append server.

	* test_webdav.py:
	(TestingDAVAppendRequestHandler): New class.
	(HttpServer_Dav_append): New class.

2006-08-24  Vincent LADEUIL  <v.ladeuil@alplog.fr>
        Accept 204 as a valid put result.
	
	* webdav.py:
	(HttpDavTransport.rename): Add some explanations.
	(HttpDavTransport.move):  204 is  also a  valid  code representing
	successful completion.

2006-08-24  Vincent LADEUIL  <v.ladeuil+lp@free.fr>
        Ensures that put is atomic.
	
	* webdav.py:
	(HttpDavTransport.put):  Makes  sure the  put  is  atomic even  on
	non-conforming servers.

	* __init__.py: 
	Check  the  bzr version  here,  no need  to  import  just to  say:
	"Finally, I can't work".

2006-08-23  Vincent LADEUIL  <v.ladeuil+lp@free.fr>
        Another fix recommanded by jam

	* test_webdav.py:
	(TestingDAVRequestHandler._read_chunk): Don't use string.atoi.

2006-08-23-1  Vincent LADEUIL  <v.ladeuil+lp@free.fr>

	* test_webdav.py:
	(TestingDAVRequestHandler._read_chunk): Don't use string.atoi.

	* __init__.py: 
	Lazily register the  transports so that the module  is loaded when
	needed.

	* webdav.py: 
	Check the  bzr version and requires  a dev one. We  are not mature
	enough.
	Check pycurl availability before importing transport.http._pycurl.  
	Transports registration is now done in __init__.py (jam hint).
	(HttpDavTransport.__init__): Use the class name when calling super
	or it will create a loop if called by the daughter class :( Assert
	we can handle the protocol.
	(HttpDavTransport.put): Mentions that put  is atomic (by virtue of
	RFC2068). Don't handle string object anymore.
	(HttpDavTransport.rename):   Rename  should   not   overwrite  the
	destination URI.
	(get_test_permutations): import test_webdav when required only.

	* test_webdav.py: New file, extracted from webdav.py.
	(TestingDAVRequestHandler.do_COPY):  RFC2518  not  RFC2519!   Damn
	hhtp!
	(TestingDAVRequestHandler.do_MOVE):  Handles the  Overwrite header
	to conform  to bzr expectations concerning the  POSIX semantics of
	move and rename (thanks jam for the explanation).
	(HttpServer_Dav.__init__): Use  the class name  when calling super
	or it will create a loop if called by the daughter class :(

2006-08-23  Vincent LADEUIL  <v.ladeuil+lp@free.fr>

	* webdav.py:
	(HttpDavTransport.put): Should we really recognize 404 there ?
	(TestingDAVRequestHandler._retry_if_not_available):  Tries to work
	around Mac OS X strange socket behavior.
	(TestingDAVRequestHandler._read,
	TestingDAVRequestHandler._readline): New methods.
	(TestingDAVRequestHandler.do_PUT): Catches more exceptions.

2006-08-22  Vincent LADEUIL  <v.ladeuil+lp@free.fr>

	* webdav.py:
	(HttpDavTransport.mkdir,                     HttpDavTransport.copy,
	HttpDavTransport.move,        HttpDavTransport.delete):        Use
	_set_curl_options to unify the use of curl.
	(HttpDavTransport.put): Use _set_curl_options  to unify the use of
	curl. Translate 403 as NoSuchFile too.

2006-08-22-1  Vincent LADEUIL  <v.ladeuil+lp@free.fr>

	*  webdav.py: Add  more TODOs  and FIXMEs  :-) Put  at  least this
	version passes bzr selftest (except for lock_write and copy_to for
	which need and.or intent is not clear.
	(HttpDavTransport.__init__,         _set_curl_options):        Use
	self.__class__.   We don't want  to change  the super()  call each
	time the class is renamed.
	(mkdir): Quotes should be right. Even in comment, even in jokes:-)
	(HttpDavTransport.copy): New method.
	(HttpDavTransport.put): 204! We expect 204 not 404.
	(HttpDavTransport.move): Raise exceptions on errors.
	(HttpDavTransport.delete):  Horrrrrrible workaround.   Try  to get
	devs advice asap.
	(TestingDAVRequestHandler,  HttpServer_Dav):  First implementation
	of a test server.

2006-08-20  Vincent LADEUIL
	First succesful  bzr.dev push.  Requires that bzr.dev  allows dirs
	for http.

	* webdav.py:
	(HttpDavTransport):  Renamed from  WebDavTransport,  but there  is
	HttpTransport_urllib and PyCurlTransport so it may change again...
	(HttpDavTransport._set_curl_options): New func, not yet used.
	(HttpDavTransport.mkdir):  Absorbs  data  otherwise  displayed  on
	stdout by libcurl.
	(HttpDavTransport.append): Documents that the position returned is
	the  one *before* the  append takes  place. The  implementation is
	still naive, but at least correct :-)
	(HttpDavTransport.put): Can be called  with a file-like object *or
	a  string* !  Handles the  string case.  Can also  be  called when
	intermediate directories are missing.
	(HttpDavTransport.move): Absorbs  data  otherwise  displayed  on
	stdout by libcurl.
	(HttpDavTransport.delete): Absorbs  data  otherwise  displayed  on
	stdout by libcurl.

 	* NOTES: 
	New file.
	
	* TODO: 
	New file.

2006-08-17  Vincent LADEUIL
	First version accepting an initial push.

	* __init__.py: 
	New file.

	* webdav.py:
	New file.

